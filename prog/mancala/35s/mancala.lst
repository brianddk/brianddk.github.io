M001 LBL "MANCA"
M002         XEQ M015	;[INIT]                      ; Init the game registers
M003         ;LBL M003	;[MAIN]                      ; Main game loop
M003             XEQ M034	;[CHECK-WINNER]          ; Check for a winner
M004             FS? 3                       ; Flag3 = Winner Found!
M005                 GTO M013	;[DONE]              ; Finished when a winner is found
M006             ;LBL M006	;[REDISPLAY]             ; Come here if we pick bad
M006             XEQ M055	;[DISPLAY]               ; Display the game board
M007             XEQ M104	;[PICK]                  ; Pick a move
M008             FS? 4                       ; Invalid move?
M009                 GTO M006	;[REDISPLAY]         ; .. Redisplay
M010             XEQ M128	;[MOVE]                  ; Move the beans
M011             XEQ M185	;[SWITCH]                ; Swithch players
M012         GTO M003	;[MAIN]                      ; Loop for next move
M013         ;LBL M013	;[DONE]                      ; This is where we finish
M013         XEQ M201	;[CLEANUP]                   ; Cleanup we are done
M014     RTN
M015     ;LBL M015	;[INIT]                          ; Init the game registers
M015         CF 1                            ; Clear our flag regs
M016         CF 2
M017         CF 3
M018         CF 4
M019         13.0                            ; For i in 13..1
M020         STO I                           ; i
M021         4.0                             ; st-x = 4
M022         ;LBL M022	;[INIT-LOOP]
M022             STO (I)                     ; 4->(i)
M023             DSE I                       ; DSE i
M024         GTO M022	;[INIT-LOOP]
M025         0.0                             ; i now equals zero
M026         STO (I)                         ; 0->(i), i = 0
M027         7.0
M028         STO I
M029         X<>Y
M030         STO (I)                         ; 0->(i), i = 7
M031         SF 1                            ; P1'S Turn
M032         GRAD                            ; 42s Only, P1 indicator
M033     RTN
M034     ;LBL M034	;[CHECK-WINNER]
M034         SF 10                           ; For 35s prompting
M035         CF 3                            ; Clear winner found flag
M036         0
M037         STO J                           ; j
M038         7
M039         STO I                           ; i
M040         24.0
M041         RCL (I)                         ; (i)
M042         X>=Y?
M043             GTO M049	;[P1-WINNER]
M044         X<>Y
M045         RCL (J)                         ; (j)
M046         X>=Y?
M047             GTO M051	;[P2-WINNER]
M048         GTO M053	;[WINNER-RTN]
M049         ;LBL M049	;[P1-WINNER]
M049             "Player 1 won!"
M050             GTO M052	;[WINNER-DONE]
M051         ;LBL M051	;[P2-WINNER]
M051             "Player 2 won!"
M052         ;LBL M052	;[WINNER-DONE]
M052             SF 3                        ; Set winner found flag
M053         ;LBL M053	;[WINNER-RTN]
M053         CF 10                           ; Restore (35s) default
M054     RTN
M055     ;LBL M055	;[DISPLAY]
M055         1.006
M056         STO I                           ; i
M057         14
M058         STO J                           ; "$(j)" == "$(14)"
M059         1000000.0
M060         STO (J)                         ; (j)=1,000,000
M061         ;LBL M061	;[P1-BOARD]
M061             10.0                        ; WARN Base 10 for now
M062             6
M063             RCL I                       ; i
M064             IP
M065             -
M066             Y^X                         ; i^(6-ip(i))
M067             RCL (I)                     ; (i)
M068             x                           ; i^(6-ip(i)) * $(i)
M069             STO+ (J)                    ; @(j) += i^(6-ip(i)) + $(i)
M070             ISG I                       ; i
M071         GTO M061	;[P1-BOARD]
M072         15
M073         STO J                           ; j = P2-vector
M074         1000000.0
M075         STO (J)
M076         13.007
M077         STO I
M078         ;LBL M078	;[P2-BOARD]
M078             10.0                        ; WARN Base 10 for now
M079             RCL I
M080             IP
M081             8
M082             -
M083             Y^X
M084             RCL (I)
M085             x
M086             STO+ (J)
M087             DSE I
M088         GTO M078	;[P2-BOARD]
M089         14
M090         STO I                           ; i = P1-vector
M091         FIX 2
M092         RCL 7                           ; P1 SCORE
M093         100
M094         /
M095         STO+ (I)                        ; P1 VECTOR
M096         RCL 0
M097         100
M098         /
M099         STO+ (J)                        ; P2 VECTOR
M100         RCL (J)                         ; P2
M101         RCL (I)                         ; P1
M102         STOP
M103     RTN
M104     ;LBL M104	;[PICK]
M104         CF 4
M105         IP
M106         1
M107         X<>Y
M108         X<Y?
M109             SF 4
M110         6
M111         X<>Y
M112         X>Y?
M113             SF 4
M114         FS? 4
M115             GTO M126	;[PICK-DONE]
M116         STO I                           ; i=PICK
M117         FS? 1
M118             GTO M123	;[CHECK-PICK]
M119         14
M120         X<>Y
M121         -
M122         STO I                           ; i
M123         ;LBL M123	;[CHECK-PICK]
M123         RCL (I)                         ; (i)
M124         X=0?
M125             SF 4
M126         ;LBL M126	;[PICK-DONE]
M126         RCL I                           ; i
M127     RTN
M128     ;LBL M128	;[MOVE]
M128         0
M129         X<> (I)                         ; (i)= 0 (MOVE BEANS OUT)
M130         STO J                           ; j=VALUE PREVIOUSLY IN (i)
M131         ;LBL M131	;[MOVE-LOOP]
M131             1.0
M132             RCL+ I                      ; i++ (MOVE REGISTER FORWARD)
M133             14.0
M134             MOD
M135             STO I                       ; i=(i+1)MOD(14)
M136             FS? 1                       ; P1?
M137                 XEQ M149	;[SKIP0]             ; SKIP0 IF P1
M138             FS? 2
M139                 XEQ M153	;[SKIP7]             ; SKIP7 IF P2
M140             1.0
M141             STO+ (I)                    ; (i)=(i)+1
M142             DSE J                       ; j--
M143         GTO M131	;[MOVE-LOOP]
M144         1.0
M145         RCL (I)
M146         X=Y?
M147             XEQ M159	;[WIN-BEANS]
M148     RTN
M149     ;LBL M149	;[SKIP0]
M149         X=0?
M150             ISG I
M151         CF 0                            ; NOP
M152     RTN
M153     ;LBL M153	;[SKIP7]
M153         7
M154         X<>Y
M155         X=Y?
M156             ISG I
M157         CF 0                            ; NOP
M158     RTN
M159     ;LBL M159	;[WIN-BEANS]
M159         7
M160         RCL I
M161         FS? 1
M162             GTO M166	;[P1-WINBEANS]
M163         FS? 2
M164             GTO M172	;[P2-WINBEANS]
M165         RTN
M166         ;LBL M166	;[P1-WINBEANS]
M166             7.0
M167             STO J
M168             Rv
M169             X>=Y?
M170                 RTN
M171             GTO M177	;[DONE-WINBEANS]
M172         ;LBL M172	;[P2-WINBEANS]
M172             0.0
M173             STO J
M174             Rv
M175             X<=Y?
M176                 RTN
M177         ;LBL M177	;[DONE-WINBEANS]
M177         14.0
M178         X<>Y
M179         -
M180         STO I
M181         0
M182         X<> (I)
M183         STO+ (J)
M184     RTN
M185     ;LBL M185	;[SWITCH]
M185         7
M186         RCL I                           ; i contains the final register of move
M187         X=Y?                            ; if i=7, landed in a bank, free move
M188             RTN
M189         X=0?                            ; if i=0, landed in a bank, free move
M190             RTN
M191         FS? 1
M192         GTO M197	;[SWITCHTO-P2]
M193             CF 2
M194             SF 1
M195             GRAD
M196             GTO M200	;[SWITCH-DONE]
M197         ;LBL M197	;[SWITCHTO-P2]
M197             CF 1
M198             SF 2
M199             RAD
M200         ;LBL M200	;[SWITCH-DONE]
M200     RTN
M201     ;LBL M201	;[CLEANUP]
M201         CF 1
M202         CF 2
M203         CF 3
M204         CF 4
M205         FIX 4
M206         DEG
M207     RTN
M208 END
